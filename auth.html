<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moco - Login / Registro</title>
<link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans&family=Gochi+Hand&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<style>
/* =================== LOGIN / REGISTER =================== */
.auth-container {
    max-width: 400px;
    margin: 60px auto;
    background: var(--color-container);
    border: 3px solid var(--color-container-border);
    border-radius: var(--radius-large);
    padding: 40px 30px;
    box-shadow: var(--shadow-soft);
    position: relative;
    overflow: hidden;
}

.auth-container h1 {
    font-family: 'Pixelify Sans', sans-serif;
    text-align: center;
    font-size: 40px;
    color: var(--color-text-dark);
    margin-bottom: 30px;
}

.auth-form {
    display: flex;
    flex-direction: column;
    gap: 18px;
    margin-bottom: 30px;
}

.auth-form input {
    padding: 14px 20px;
    border-radius: var(--radius-medium);
    border: 3px solid var(--color-input-border);
    font-family: 'Gochi Hand', cursive;
    font-size: 16px;
    outline: none;
    transition: border 0.3s;
}

.auth-form input:focus {
    border-color: var(--color-input-border-focus);
}

.auth-form button {
    padding: 14px 20px;
    border: none;
    border-radius: var(--radius-medium);
    background: var(--color-primary);
    color: white;
    font-family: 'Pixelify Sans', sans-serif;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
}

.auth-form button:hover {
    background: var(--color-primary-hover);
    transform: scale(1.05);
}

.toggle-auth {
    text-align: center;
    font-family: 'Gochi Hand', cursive;
    font-size: 14px;
    color: var(--color-text-medium);
    cursor: pointer;
}

.toggle-auth span {
    color: var(--color-primary);
    font-weight: 700;
    text-decoration: underline;
}

@media (max-width: 480px) {
    .auth-container { margin: 40px 15px; padding: 30px 20px; }
    .auth-container h1 { font-size: 32px; }
}
</style>
</head>
<body>

<div class="auth-container">
    <h1>Moco</h1>

    <!-- LOGIN -->
    <form class="auth-form" id="login-form">
        <input type="email" id="login-email" placeholder="Correo" required>
        <input type="password" id="login-pass" placeholder="Contraseña" required>
        <button type="submit">Iniciar sesión</button>
    </form>

    <!-- REGISTER -->
    <form class="auth-form" id="register-form" style="display:none;">
        <input type="email" id="register-email" placeholder="Correo" required>
        <input type="password" id="register-pass" placeholder="Contraseña" required>
        <button type="submit">Registrarse</button>
    </form>

    <div class="toggle-auth">
        <span id="toggle-login">¿No tienes cuenta? Registrarse</span>
    </div>
</div>

<script type="module">
import { auth, db } from './firebase.js';
import { createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { doc, setDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const loginForm = document.getElementById('login-form');
const registerForm = document.getElementById('register-form');
const toggleLogin = document.getElementById('toggle-login');

// Redirigir si ya está logueado
onAuthStateChanged(auth, user => {
    if(user) window.location.href = "index.html";
});

// Alternar login/register
toggleLogin.addEventListener('click', () => {
    if(loginForm.style.display === 'none') {
        loginForm.style.display = 'flex';
        registerForm.style.display = 'none';
        toggleLogin.textContent = '¿No tienes cuenta? Registrarse';
    } else {
        loginForm.style.display = 'none';
        registerForm.style.display = 'flex';
        toggleLogin.textContent = '¿Ya tienes cuenta? Iniciar sesión';
    }
});

// LOGIN
loginForm.addEventListener('submit', async e => {
    e.preventDefault();
    const email = document.getElementById('login-email').value;
    const pass = document.getElementById('login-pass').value;
    try {
        await signInWithEmailAndPassword(auth, email, pass);
        window.location.href = "index.html";
    } catch(err) {
        alert(err.message);
    }
});

// REGISTER
registerForm.addEventListener('submit', async e => {
    e.preventDefault();
    const email = document.getElementById('register-email').value;
    const pass = document.getElementById('register-pass').value;
    try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
        // Crear documento inicial en Firestore
        await setDoc(doc(db, "usuarios", userCredential.user.uid), { listas: [], listaActiva: 1 });
        window.location.href = "index.html";
    } catch(err) {
        alert(err.message);
    }
});
</script>

</body>
</html>
